<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>任務回報模板產生器</title>

    <!-- ⭐ style.css 已完全內嵌 -->
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px 24px 32px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        h1 {
            margin-top: 0;
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 1.2rem;
        }

        h2 {
            font-size: 1.1rem;
            border-left: 4px solid #4a90e2;
            padding-left: 8px;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .section {
            margin-bottom: 1.5rem;
            padding: 10px 12px 14px;
            border-radius: 8px;
            background-color: #fafafa;
        }

        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.7rem;
            gap: 8px;
        }

        .form-row.vertical {
            flex-direction: column;
            align-items: flex-start;
        }

        .form-row label {
            min-width: 120px;
            font-weight: 500;
        }

        .form-row input[type="text"],
        .form-row input[type="date"],
        .form-row select,
        textarea {
            font-size: 0.95rem;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        .form-row input[type="text"],
        .form-row input[type="date"],
        .form-row select {
            flex: 1;
        }

        textarea {
            width: 100%;
            resize: vertical;
        }

        .slash {
            margin: 0 4px;
        }

        /* 富文字編輯器（可貼圖片） */
        .rich-editor {
            width: 100%;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 6px 8px;
            font-size: 0.95rem;
            background-color: #fff;
            overflow-y: auto;
        }

        .rich-editor.large {
            min-height: 140px;
        }

        .rich-editor.medium {
            min-height: 80px;
        }

        .rich-editor:focus {
            outline: 2px solid #4a90e2;
        }

        .rich-editor[placeholder]:empty:before {
            content: attr(placeholder);
            color: #999;
        }

        .autocomplete-wrapper {
            position: relative;
            flex: 1;
        }

        .autocomplete-wrapper.inline {
            flex: 1;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
            display: none;
        }

        .suggestion-item {
            padding: 6px 8px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .suggestion-item:hover {
            background-color: #e6f2ff;
        }

        .ios-browser-wrapper {
            display: none;
            align-items: center;
            gap: 6px;
        }

        .button-row {
            text-align: center;
            margin-top: 1rem;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            padding: 7px 14px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            background-color: #4a90e2;
            color: #ffffff;
        }

        button:hover {
            background-color: #357bd8;
        }

        #preview-text {
            width: 100%;
            box-sizing: border-box;
            font-family: "Courier New", monospace;
            font-size: 0.9rem;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: #fdfdfd;
        }
    </style>
</head>



<body>
<div class="container">
    <h1>任務回報模板產生器</h1>

    <form id="report-form" onsubmit="return false;">
        <div class="section">
            <h2>基本資訊</h2>

            <!-- 日期 -->
            <div class="form-row">
                <label for="incident_date">發生時間：</label>
                <input type="date" id="incident_date" required />
            </div>

            <!-- 測試者 -->
            <div class="form-row">
                <label>測試者：</label>
                <div class="autocomplete-wrapper">
                    <input type="text" id="tester" class="memory-input" data-memory-key="tester">
                    <div class="suggestions"></div>
                </div>
            </div>

            <!-- 版本 -->
            <div class="form-row">
                <label>版本：</label>
                <div class="autocomplete-wrapper">
                    <input type="text" id="version" class="memory-input" data-memory-key="version">
                    <div class="suggestions"></div>
                </div>
            </div>

            <!-- 站別 -->
            <div class="form-row">
                <label for="site">站別：</label>
                <select id="site">
                    <option value="QA站">QA站</option>
                    <option value="PROD站">PROD站</option>
                </select>
            </div>

            <!-- 廳主 / 帳號 -->
            <div class="form-row">
                <label>測試廳主／帳號：</label>
                <select id="hall">
                    <option value="Tidy遊戲商測試廳">Tidy遊戲商測試廳</option>
                    <option value="Tidy遊戲級距測試廳">Tidy遊戲級距測試廳</option>
                    <option value="DB TEST">DB TEST</option>
                </select>

                <span class="slash">/</span>

                <div class="autocomplete-wrapper inline">
                    <input type="text" id="account" class="memory-input" data-memory-key="account">
                    <div class="suggestions"></div>
                </div>
            </div>

            <!-- 裝置 -->
            <div class="form-row">
                <label for="device">裝置：</label>
                <select id="device">
                    <option value="PC">PC</option>
                    <option value="Android">Android</option>
                    <option value="iOS">iOS</option>
                </select>

                <div id="ios-browser-wrapper" class="ios-browser-wrapper">
                    <span class="slash">/</span>
                    <select id="ios_browser">
                        <option value="Chrome">Chrome</option>
                        <option value="Safari">Safari</option>
                    </select>
                </div>
            </div>

            <!-- 注單編號 -->
            <div class="form-row">
                <label for="order_id">注單編號：</label>
                <input type="text" id="order_id">
            </div>
        </div>


        <!-- 描述內容 -->
        <div class="section">
            <h2>描述內容（可貼圖片）</h2>

            <div class="form-row vertical">
                <label>操作：</label>
                <div id="operation_editor" class="rich-editor large" contenteditable="true"></div>
            </div>

            <div class="form-row vertical">
                <label>實際結果：</label>
                <div id="actual_editor" class="rich-editor large" contenteditable="true"></div>
            </div>

            <div class="form-row vertical">
                <label>預期結果：</label>
                <div id="expected_editor" class="rich-editor large" contenteditable="true"></div>
            </div>

            <div class="form-row vertical">
                <label>備註：</label>
                <div id="remark_editor" class="rich-editor medium" contenteditable="true"></div>
            </div>
        </div>

        <!-- 一鍵複製 -->
        <div class="button-row">
            <button type="button" id="copy-btn">一鍵複製</button>
        </div>
    </form>

    <!-- 預覽 -->
    <div class="section output-section">
        <h2>文字預覽</h2>
        <textarea id="preview-text" readonly rows="16"></textarea>
    </div>
</div>




<!-- ⭐ JS 功能全部內嵌（完全保留你原本邏輯） -->
<script>
/* 設定預設今天日期 */
function setToday() {
    const d = document.getElementById("incident_date");
    const now = new Date();
    const yyyy = now.getFullYear();
    const mm = String(now.getMonth() + 1).padStart(2, "0");
    const dd = String(now.getDate()).padStart(2, "0");
    d.value = `${yyyy}-${mm}-${dd}`;
}

/* iOS 瀏覽器欄位控制 */
function updateIOS() {
    const device = document.getElementById("device").value;
    document.getElementById("ios-browser-wrapper").style.display =
        device === "iOS" ? "inline-flex" : "none";
}

/* localStorage autocomplete */
function loadMemory(key){ try { return JSON.parse(localStorage.getItem("memory_"+key)) || []; } catch { return []; } }
function saveMemory(key, arr){ localStorage.setItem("memory_"+key, JSON.stringify(arr)); }

function setupMemory() {
    document.querySelectorAll(".memory-input").forEach(input => {
        const key = input.dataset.memoryKey;
        let items = loadMemory(key);

        const wrap = input.closest(".autocomplete-wrapper");
        const box = wrap.querySelector(".suggestions");

        input.addEventListener("focus", () => renderSuggest(input, box, items, ""));
        input.addEventListener("input", () => renderSuggest(input, box, items, input.value));

        input.addEventListener("blur", () => {
            const v = input.value.trim();
            if (v && !items.includes(v)){
                items.push(v);
                saveMemory(key, items);
            }
            setTimeout(()=> box.style.display="none", 150);
        });
    });
}

function renderSuggest(input, box, items, filter){
    const key = filter.trim().toLowerCase();
    const list = key ? items.filter(i=>i.toLowerCase().includes(key)) : items;

    if (!list.length){ box.style.display="none"; return; }

    box.innerHTML = "";
    list.forEach(v=>{
        const d=document.createElement("div");
        d.className="suggestion-item";
        d.textContent=v;
        d.addEventListener("mousedown",()=>{
            input.value=v;
            box.style.display="none";
            buildPreview();
        });
        box.appendChild(d);
    });
    box.style.display="block";
}

/* 建立純文字預覽 */
function buildPreview(){
    const pv = document.getElementById("preview-text");

    const incidentDate = document.getElementById("incident_date").value;
    const tester = document.getElementById("tester").value;
    const version = document.getElementById("version").value;
    const site = document.getElementById("site").value;
    const hall = document.getElementById("hall").value;
    const account = document.getElementById("account").value;
    const device = document.getElementById("device").value;
    const iosBrowser = document.getElementById("ios_browser").value;
    const orderId = document.getElementById("order_id").value;

    const op = document.getElementById("operation_editor").innerText.trim();
    const act = document.getElementById("actual_editor").innerText.trim();
    const exp = document.getElementById("expected_editor").innerText.trim();
    const remark = document.getElementById("remark_editor").innerText.trim();

    let deviceLine = "裝置：" + device;
    if (device === "iOS"){
        deviceLine += " / " + iosBrowser;
    }

    const text = [
        `發生時間：${incidentDate}`,
        `測試者：${tester}`,
        `版本：${version}`,
        `站別：${site}`,
        `測試廳主／帳號：${hall} / ${account}`,
        deviceLine,
        `注單編號：${orderId}`,
        "",
        "操作：",
        op,
        "",
        "實際結果：",
        act,
        "",
        "預期結果：",
        exp,
        "",
        "備註：",
        remark
    ].join("\n");

    pv.value = text;
}

/* 一鍵複製 */
function copyText(){
    const text = document.getElementById("preview-text").value;
    navigator.clipboard.writeText(text)
        .then(()=> alert("已複製到剪貼簿"))
        .catch(()=>{
            const area=document.getElementById("preview-text");
            area.select();
            document.execCommand("copy");
            alert("已複製到剪貼簿");
        });
}

/* 初始化 */
window.addEventListener("DOMContentLoaded", ()=>{
    setToday();
    setupMemory();
    updateIOS();
    buildPreview();

    document.getElementById("device").addEventListener("change", ()=>{
        updateIOS();
        buildPreview();
    });

    [
        "incident_date","tester","version","site",
        "hall","account","order_id","ios_browser"
    ].forEach(id=>{
        const el=document.getElementById(id);
        el.addEventListener("input", buildPreview);
        el.addEventListener("change", buildPreview);
    });

    ["operation_editor","actual_editor","expected_editor","remark_editor"]
        .forEach(id=>{
            const el=document.getElementById(id);
            el.addEventListener("input", buildPreview);
            el.addEventListener("keyup", buildPreview);
        });

    document.getElementById("copy-btn").addEventListener("click", copyText);
});
</script>

</body>
</html>
