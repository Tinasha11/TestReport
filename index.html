<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>任務回報模板產生器</title>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px 24px 32px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        h1 {
            margin-top: 0;
            text-align: center;
            font-size: 1.6rem;
            margin-bottom: 1.2rem;
        }

        h2 {
            font-size: 1.1rem;
            border-left: 4px solid #4a90e2;
            padding-left: 8px;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .section {
            margin-bottom: 1.5rem;
            padding: 10px 12px 14px;
            border-radius: 8px;
            background-color: #fafafa;
        }

        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.7rem;
            gap: 8px;
        }

        .form-row.vertical {
            flex-direction: column;
            align-items: flex-start;
        }

        .form-row label {
            min-width: 120px;
            font-weight: 500;
        }

        .form-row input[type="text"],
        .form-row input[type="date"],
        .form-row select,
        textarea {
            font-size: 0.95rem;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        .form-row input[type="text"],
        .form-row input[type="date"],
        .form-row select {
            flex: 1;
        }

        textarea {
            width: 100%;
            resize: vertical;
        }

        .slash {
            margin: 0 4px;
        }

        .rich-editor {
            width: 100%;
            box-sizing: border-box;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 6px 8px;
            font-size: 0.95rem;
            background-color: #fff;
            overflow-y: auto;
        }

        .rich-editor.large {
            min-height: 140px;
        }

        .rich-editor.medium {
            min-height: 80px;
        }

        .autocomplete-wrapper {
            position: relative;
            flex: 1;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #ffffff;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            max-height: 200px;
            overflow-y: auto;
            z-index: 50;
            display: none;
        }

        .suggestion-item {
            padding: 6px 8px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #e6f2ff;
        }

        /* ⭐ 新增標題區樣式 */
        .title-section {
            margin-bottom: 1.5rem;
            padding: 10px 12px 14px;
            border-radius: 8px;
            background-color: #fafafa;
        }

        #title-preview {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 0.95rem;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        #full-preview {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: "Courier New", monospace;
            font-size: 0.9rem;
            box-sizing: border-box;
            background-color: #fdfdfd;
        }

        /* ⭐ 從舊版完整移植的按鈕設計 */
        .button-row {
            text-align: center;
            margin-top: 1rem;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        button {
            padding: 7px 14px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            background-color: #4a90e2;
            color: #ffffff;
        }

        button:hover {
            background-color: #357bd8;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>任務回報模板產生器</h1>

    <!-- ⭐ 任務標題區塊 -->
    <div class="title-section">
        <h2>任務標題</h2>

        <div class="form-row">
            <label>遊戲：</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="game-select" placeholder="搜尋遊戲（GameID 或名稱）">
                <div class="suggestions" id="game-suggestions"></div>
            </div>
        </div>

        <div class="form-row">
            <label>問題描述：</label>
            <input type="text" id="problem-desc" placeholder="簡述本次問題">
        </div>
    </div>

    <!-- ⭐ 基本資訊 -->
    <div class="section">
        <h2>基本資訊</h2>

        <div class="form-row">
            <label for="incident_date">發生時間：</label>
            <input type="date" id="incident_date" required />
        </div>

        <div class="form-row">
            <label for="tester">測試者：</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="tester" class="memory-input" data-memory-key="tester">
                <div class="suggestions"></div>
            </div>
        </div>

        <div class="form-row">
            <label for="version">版本：</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="version" class="memory-input" data-memory-key="version">
                <div class="suggestions"></div>
            </div>
        </div>

        <div class="form-row">
            <label for="site">站別：</label>
            <select id="site">
                <option value="QA站">QA站</option>
                <option value="PROD站">PROD站</option>
            </select>
        </div>

        <div class="form-row">
            <label>測試廳主／帳號：</label>
            <select id="hall">
                <option value="Tidy遊戲商測試廳">Tidy遊戲商測試廳</option>
                <option value="Tidy遊戲級距測試廳">Tidy遊戲級距測試廳</option>
                <option value="DB TEST">DB TEST</option>
            </select>

            <span class="slash">/</span>

            <div class="autocomplete-wrapper inline">
                <input type="text" id="account" class="memory-input" data-memory-key="account">
                <div class="suggestions"></div>
            </div>
        </div>

        <div class="form-row">
            <label for="device">裝置：</label>
            <select id="device">
                <option value="PC">PC</option>
                <option value="Android">Android</option>
                <option value="iOS">iOS</option>
            </select>

            <div id="ios-browser-wrapper" class="ios-browser-wrapper" style="display:none;">
                <span class="slash">/</span>
                <select id="ios_browser">
                    <option value="Chrome">Chrome</option>
                    <option value="Safari">Safari</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <label for="order_id">注單編號：</label>
            <input type="text" id="order_id">
        </div>
    </div>

    <!-- ⭐ 描述內容（可貼圖片） -->
    <div class="section">
        <h2>描述內容（可貼圖片）</h2>

        <div class="form-row vertical">
            <label>操作：</label>
            <div id="operation_editor" class="rich-editor large" contenteditable="true"></div>
        </div>

        <div class="form-row vertical">
            <label>實際結果：</label>
            <div id="actual_editor" class="rich-editor large" contenteditable="true"></div>
        </div>

        <div class="form-row vertical">
            <label>預期結果：</label>
            <div id="expected_editor" class="rich-editor large" contenteditable="true"></div>
        </div>

        <div class="form-row vertical">
            <label>備註：</label>
            <div id="remark_editor" class="rich-editor medium" contenteditable="true"></div>
        </div>
    </div>

    <!-- ⭐ 按鈕列（使用舊版 UI） -->
    <div class="button-row">
        <button type="button" id="copy-title-btn">複製標題</button>
        <button type="button" id="copy-btn">一鍵複製</button>
    </div>

    <!-- ⭐ 新版：小框 + 大框預覽 -->
    <div class="section output-section">
        <h2>文字預覽</h2>

        <input type="text" id="title-preview" readonly />
        <textarea id="full-preview" readonly rows="16"></textarea>
    </div>

</div> <!-- END container -->
<script>
/* -------------------------------------------
   自動填現在日期
------------------------------------------- */
function setToday() {
    const d = document.getElementById("incident_date");
    const today = new Date().toISOString().split("T")[0];
    d.value = today;
}

/* -------------------------------------------
   遊戲列表
------------------------------------------- */
const gameList = [
    ["Game101","瘋狂實驗室"],["Game102","開運金獅"],["Game103","星際冒險"],
    ["Game104","精靈奇園"],["Game105","功夫高手"],["Game106","淘金樂"],
    ["Game107","國王的祕寶"],["Game108","南極世界"],["Game109","荒野大西部"],
    ["Game110","超級猴子"],["Game111","刺客密令"],["Game112","白蛇傳"],
    ["Game113","美味一番"],["Game114","幸運派翠克"],["Game115","魚蝦蟹 slot"],
    ["Game116","叱吒西遊"],["Game117","鬥士傳奇"],["Game118","小紅帽:送餐大作戰"],
    ["Game119","威震公堂"],["Game120","魔法學園"],["Game122","發大柴"],
    ["Game139","金福瑞獸"],["Game123","巨獸金剛"],["Game124","刮刮樂"],
    ["Game125","奇門遁甲"],["Game126","泰濕控"],["Game127","暹羅神拳"],
    ["Game128","哥布林礦坑"],["Game129","湖中女神"],["Game130","古墓驚魂"],
    ["Game131","絕世神偷"],["Game132","羅摩衍那"],["Game133","骰寶"],
    ["Game134","百家樂"],["Game135","5PK"],["Game136","水果樂園"],
    ["Game137","遠古生物"],["Game138","魔豆"],["Game121","21點"],
    ["Game140","神醫百草傳"],["Game141","龍宮寶藏"],["Game142","維京傳奇"],
    ["Game143","大笑彌勒"],["Game144","日輪寶殿"],["Game145","要塞爭奪戰"],
    ["Game146","永恆之吻"],["Game147","龍門試練"],["Game148","非洲獅王"],
    ["Game149","迎財神"],["Game150","撒哈拉奇緣"],["Game151","牛牛娶親"],
    ["Game152","金牛發發發"],["Game153","馬雅末日"],["Game154","野性的渴望"],
    ["Game155","搗蛋好來屋"],["Game156","招財聚寶"],["Game157","加勒比奇航"],
    ["Game158","伯利恆之星"],["Game159","添運財神"],["Game160","三國群雄"],
    ["Game161","JP麻將胡了"],["Game162","敲吉鼠"],["Game163","786 SLOT"],
    ["Game164","龍珠 ‧ 天命"],["Game165","刮刮樂2 龍耀無限"],
    ["Game166","刮刮樂3 羊羊derE"],["Game167","埃及祕寶"],["Game168","擊鼓迎福"],
    ["Game169","EDM迷幻"],["Game170","四象拱財"],["Game171","巫毒傳說"],
    ["Game172","花開富貴"],["Game173","速度與激情"],["Game174","花式5PK"],
    ["Game175","福虎臨門"],["Game176","超級射門"],["Game177","DICE"],
    ["Game178","鳳凰傳說"],["Game179","伊甸王座"],["Game180","電音兔兔"],
    ["Game181","吐鈔機"],["Game182","迎財神 2"],["Game183","添運財神2"],
    ["Game184","黃金麻將"],["Game185","金銀鯉"],["Game186","星海征戰"],
    ["Game187","轟蜜大作戰"],["Game188","烽起雲湧時"],["Game189","海洋物語"],
    ["Game190","命運之手"],["Game191","爆焰足球"],["Game192","好運金蟾"],
    ["Game193","F.T.G榮耀前線"],["Game194","拉密"],["Game195","武神趙子龍"],
    ["Game196","牛轉錢坤"],["Game197","東郊皇陵"],["Game198","武聖關羽"],
    ["Game199","惡魔甜心"],["Game200","天使寶貝"],["Game201","JP麻將胡了2"],
    ["Game202","星爆宇宙"],["Game203","點蛇成金"],["Game204","封神傳奇"],
    ["Game205","開門大吉"],["Game206","牛轉錢坤2"],["Game207","虎嘯龍吟"],
    ["Game208","射龍門"],["Game209","添運財神3"],["Game210","皇家老虎機"],
    ["Game211","財神妙"],["Game212","Lucky Guess"],["Game213","金豪鯉"],
    ["Game214","賽馬娘"],["Game215","X型連爆中式"]
];

/* -------------------------------------------
   遊戲搜尋列表互動
------------------------------------------- */
const gameInput = document.getElementById("game-select");
const gameSuggest = document.getElementById("game-suggestions");

function renderGameList(keyword = "") {
    const kw = keyword.trim().toLowerCase();
    gameSuggest.innerHTML = "";

    const matches = gameList.filter(([id, name]) =>
        id.toLowerCase().includes(kw) || name.toLowerCase().includes(kw)
    );

    matches.forEach(([id, name]) => {
        const div = document.createElement("div");
        div.className = "suggestion-item";
        div.textContent = `${id} ${name}`;
        div.addEventListener("mousedown", () => {
            gameInput.value = `${id} ${name}`;
            gameSuggest.style.display = "none";
            updateTitle();
        });
        gameSuggest.appendChild(div);
    });

    gameSuggest.style.display = matches.length ? "block" : "none";
}

gameInput.addEventListener("focus", () => renderGameList(""));
gameInput.addEventListener("input", () => renderGameList(gameInput.value));

document.addEventListener("click", (e) => {
    if (!gameInput.contains(e.target)) gameSuggest.style.display = "none";
});

/* -------------------------------------------
   標題組合
------------------------------------------- */
function updateTitle() {
    const full = gameInput.value.trim();
    const desc = document.getElementById("problem-desc").value.trim();
    let result = "";

    if (full) {
        const parts = full.split(" ");
        const id = parts[0];
        const name = parts.slice(1).join(" ");
        result = `【${id}】【${name}】${desc}`;
    }

    document.getElementById("title-preview").value = result;
    updateFullPreview();
}

document.getElementById("problem-desc").addEventListener("input", updateTitle);

/* -------------------------------------------
   全文預覽（包含標題以外部分）
------------------------------------------- */
function updateFullPreview() {
    const date = document.getElementById("incident_date").value;
    const tester = document.getElementById("tester").value;
    const version = document.getElementById("version").value;
    const site = document.getElementById("site").value;
    const hall = document.getElementById("hall").value;
    const account = document.getElementById("account").value;
    const device = document.getElementById("device").value;
    const iosBrowser = document.getElementById("ios_browser").value;
    const order = document.getElementById("order_id").value;

    const op = document.getElementById("operation_editor").innerText.trim();
    const act = document.getElementById("actual_editor").innerText.trim();
    const exp = document.getElementById("expected_editor").innerText.trim();
    const remark = document.getElementById("remark_editor").innerText.trim();

    let deviceLine = `裝置：${device}`;
    if (device === "iOS") deviceLine += ` / ${iosBrowser}`;

    const content = [
        `發生時間：${date}`,
        `測試者：${tester}`,
        `版本：${version}`,
        `站別：${site}`,
        `測試廳主／帳號：${hall} / ${account}`,
        deviceLine,
        `注單編號：${order}`,
        ``,
        `操作：`,
        op,
        ``,
        `實際結果：`,
        act,
        ``,
        `預期結果：`,
        exp,
        ``,
        `備註：`,
        remark
    ].join("\n");

    document.getElementById("full-preview").value = content;
}

/* -------------------------------------------
   按鈕功能：複製
------------------------------------------- */
document.getElementById("copy-title-btn").addEventListener("click", () => {
    navigator.clipboard.writeText(document.getElementById("title-preview").value);
    alert("標題已複製！");
});

document.getElementById("copy-btn").addEventListener("click", () => {
    navigator.clipboard.writeText(document.getElementById("full-preview").value);
    alert("全文已複製（不包含標題）！");
});

/* -------------------------------------------
   記憶 autocomplete
------------------------------------------- */
function loadMemory(key) {
    try { return JSON.parse(localStorage.getItem(key)) || []; }
    catch { return []; }
}

function saveMemory(key, arr) {
    localStorage.setItem(key, JSON.stringify(arr));
}

function setupMemoryField(id, key) {
    const input = document.getElementById(id);
    const wrap = input.closest(".autocomplete-wrapper");
    const box = wrap.querySelector(".suggestions");
    let memory = loadMemory(key);

    function render(filter = "") {
        const kw = filter.toLowerCase();
        box.innerHTML = "";
        const list = memory.filter(v => v.toLowerCase().includes(kw));

        list.forEach(v => {
            const div = document.createElement("div");
            div.className = "suggestion-item";
            div.textContent = v;
            div.addEventListener("mousedown", () => {
                input.value = v;
                box.style.display = "none";
                updateFullPreview();
            });
            box.appendChild(div);
        });

        box.style.display = list.length ? "block" : "none";
    }

    input.addEventListener("focus", () => render(""));
    input.addEventListener("input", () => render(input.value));
    input.addEventListener("blur", () => {
        const v = input.value.trim();
        if (v && !memory.includes(v)) {
            memory.push(v);
            saveMemory(key, memory);
        }
        setTimeout(() => box.style.display = "none", 150);
    });
}

/* -------------------------------------------
   初始化
------------------------------------------- */
window.addEventListener("DOMContentLoaded", () => {
    setToday();

    setupMemoryField("tester", "tester");
    setupMemoryField("version", "version");
    setupMemoryField("account", "account");

    document.getElementById("device").addEventListener("change", () => {
        document.getElementById("ios-browser-wrapper").style.display =
            document.getElementById("device").value === "iOS" ? "inline-flex" : "none";
        updateFullPreview();
    });

    ["incident_date","site","hall","order_id"]
        .forEach(id => document.getElementById(id).addEventListener("input", updateFullPreview));

    ["operation_editor","actual_editor","expected_editor","remark_editor"]
        .forEach(id =>
            document.getElementById(id).addEventListener("input", updateFullPreview)
        );

    updateFullPreview();
});
</script>

</body>
</html>
