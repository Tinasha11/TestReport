<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>ä»»å‹™å›å ±æ¨¡æ¿ç”¢ç”Ÿå™¨</title>

    <style>
        /* ====== åŸºæœ¬é é¢æ¨£å¼ ====== */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            border-radius: 12px;
            padding: 20px 24px 32px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        h1 {
            text-align: center;
            margin: 0 0 1.2rem 0;
            font-size: 1.6rem;
        }

        h2 {
            font-size: 1.1rem;
            border-left: 4px solid #4a90e2;
            padding-left: 8px;
            margin: 1.5rem 0 .8rem 0;
        }

        .section,
        .title-section {
            background-color: #fafafa;
            padding: 12px 14px 16px;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        /* ====== è¡¨å–®åˆ— ====== */
        .form-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.7rem;
            gap: 8px;
        }

        .form-row.vertical {
            flex-direction: column;
            align-items: flex-start;
        }

        .form-row label {
            min-width: 120px;
            font-weight: 500;
        }

        /* ====== åŸºæœ¬ input æ¨£å¼ ====== */
        input[type="text"],
        input[type="date"],
        select,
        textarea {
            font-size: 0.95rem;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        textarea {
            width: 100%;
            resize: vertical;
        }

        /* ====== å¯Œæ–‡å­—ç·¨è¼¯å™¨ ====== */
        .rich-editor {
            width: 100%;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 6px 8px;
            background-color: #fff;
            overflow-y: auto;
            font-size: .95rem;
        }
        .rich-editor.large { min-height: 140px; }
        .rich-editor.medium { min-height: 80px; }

        /* ====== autocomplete wrapper ====== */
        .autocomplete-wrapper {
            position: relative;
            flex: 1;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0; right: 0;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 50;
        }

        .suggestion-item {
            padding: 6px 8px;
            cursor: pointer;
        }
        .suggestion-item:hover {
            background-color: #e6f2ff;
        }

        #title-preview {
            width: 100%;
            padding: 6px 8px;
            border-radius: 6px;
            border: 1px solid #ccc;
            margin-bottom: 10px;
        }

        #full-preview {
            width: 100%;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-family: "Courier New", monospace;
            background-color: #fdfdfd;
        }

        /* ====== è£ç½®æ¬„ä½ï¼ˆä¿æŒåŸæ¨£ï¼‰ ====== */
        .device-row {
            display: grid;
            grid-template-columns: 120px 300px 300px;
            align-items: center;
            gap: 8px;
        }

        #pc-row {
            grid-template-columns: 120px 300px;
        }

        #ios-row {
            grid-template-columns: 120px 300px;
        }

        /* ====== â­ iOS å­é¸é …ï¼ˆæ­£å¼ä¿®æ”¹ç‰ˆï¼‰ ====== */

        /* Safari / Chrome / å…¶ä»–æ•´çµ„å·¦ç§»ï¼Œèˆ‡ä½ åœ–ç‰‡ä¸€è‡´ */
        #ios-browser-wrapper {
            margin-left: 80px;   /* ä½ æ¸¬è©¦å¾Œç¢ºå®šçš„å€¼ */
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        /* Safari / Chrome â€” å·¦ 120pxï¼ˆcheckbox + labelï¼‰ã€å³å´ 260pxï¼ˆè¼¸å…¥æ¬„ä½ï¼‰ */
        .ios-browser-group .device-row {
            display: grid;
            grid-template-columns: 120px 260px; /* ä½ æ‰‹å‹•è©¦å‡ºçš„å®Œç¾æ¯”ä¾‹ */
            gap: 10px;
        }

        /* ====== å…¶ä»–ï¼ˆOtherï¼‰ä¸‰æ¬„ï¼Œåªèª¿æ•´é€™è¡Œï¼Œä¸å½±éŸ¿ Safari/Chrome ====== */
        .ios-extra-row {
            display: grid;
            grid-template-columns: 120px 260px 220px; /* å®Œå…¨å°é½Š Safari/Chrome + Android */
            gap: 10px;
        }

        /* â€œç€è¦½å™¨ï¼ˆä¾‹ï¼šEdgeï¼‰â€ æ¬„ä½ â†’ å’Œ Safari/Chrome ä¸€æ¨£å¯¬ */
        #ios-other-name {
            width: 260px;       /* â— ä¸åŠ  !important æ‰ä¸æœƒå¹²åˆ°å…¶ä»–æ¬„ä½ */
        }

        /* â€œä¾‹ï¼š121.0â€ æ¬„ä½ â†’ ä½ç½®å¾Œé€€ï¼Œå¯¬åº¦å›ºå®š 300px */
        #ios-other-version {
            width: 300px;       /* â— ç²¾æº–å°é½Š Android çš„ç€è¦½å™¨æ¬„ä½ */
        }

        /* === è¦†å¯«æŒ‰éˆ• UIï¼ˆä¾ç…§ä½ çš„åœ–ç‰‡æ¨£å¼ï¼‰=== */
        .button-row {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
        }

        .button-row button {
            padding: 10px 26px;
            border-radius: 999px;
            border: none;
            background-color: #4a90e2;
            color: #fff;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s ease-in-out;
        }

        .button-row button:hover {
            background-color: #357bd8;
        }

        .button-row button:active {
            transform: scale(0.96);
        }

        #problem-desc {
            width: 735px !important;
        }        

        #bug_def {
            width: 644px !important;
        }

    </style>

<style>
select option[disabled]{display:none;}
</style>
</head>
<body autocomplete="off">
<div class="container">
    <h1>ä»»å‹™å›å ±æ¨¡æ¿ç”¢ç”Ÿå™¨</h1>

    <!-- ä»»å‹™æ¨™é¡Œ -->
    <div class="title-section">
        <h2>ä»»å‹™æ¨™é¡Œ</h2>

        <!-- éŠæˆ² -->
        <div class="form-row">
            <label>éŠæˆ²ï¼š</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="game-select" autocomplete="new-password" name="nohistory-game"
                    style="width: 345px;" placeholder="æœå°‹éŠæˆ²ï¼ˆGameID æˆ–åç¨±ï¼‰ï¼Œè‹¥ç„¡éœ€ä½¿ç”¨å¯ç•™ç™½">
                <div class="suggestions" id="game-suggestions"></div>
            </div>
        </div>

        <!-- å•é¡Œæè¿° -->
        <div class="form-row">
            <label>å•é¡Œæè¿°ï¼š</label>
            <input type="text" id="problem-desc" autocomplete="new-password" name="nohistory-desc"
                placeholder="ç°¡è¿°æœ¬æ¬¡å•é¡Œ">
        </div>
    </div>

    <!-- åŸºæœ¬è³‡è¨Š -->
    <div class="section">
        <h2>åŸºæœ¬è³‡è¨Š</h2>

        <div class="form-row">
            <label>ç™¼ç”Ÿæ™‚é–“ï¼š</label>
            <input type="date" id="incident_date" autocomplete="new-password" name="nohistory-date">
        </div>

        <div class="form-row">
            <label>æ¸¬è©¦è€…ï¼š</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="tester" class="memory-input"
                    data-memory-key="tester" autocomplete="new-password" name="nohistory-tester">
                <div class="suggestions"></div>
            </div>
        </div>

        <div class="form-row">
            <label>BUG ç­‰ç´šï¼š</label>
            <select id="bug_level">
                <option value="" disabled selected>è«‹é¸æ“‡</option>
                <option value="é«˜">é«˜</option>
                <option value="ä¸­">ä¸­</option>
                <option value="ä½">ä½</option>
            </select>
            <select id="bug_def" disabled>
                <option>è«‹å…ˆé¸æ“‡ BUG ç­‰ç´š</option>
            </select>
        </div>

        <div class="form-row">
            <label>ç‰ˆæœ¬ï¼š</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="version" class="memory-input"
                    data-memory-key="version" autocomplete="new-password" name="nohistory-version">
                <div class="suggestions"></div>
            </div>
        </div>

        <div class="form-row">
            <label>ç«™åˆ¥ï¼š</label>
            <select id="site">
                <option value="æ¸¬è©¦ç«™">æ¸¬è©¦ç«™</option>
                <option value="æ­£å¼ç«™">æ­£å¼ç«™</option>
                <option value="é–‹ç™¼ç«™">é–‹ç™¼ç«™</option>
                <option value="è©¦ç©æ¨¡å¼">è©¦ç©æ¨¡å¼</option>
            </select>
        </div>

        <div class="form-row">
            <label>æ¸¬è©¦å»³ä¸»ï¼å¸³è™Ÿï¼š</label>
            <select id="hall">
                <option value="TidyéŠæˆ²å•†æ¸¬è©¦å»³">TidyéŠæˆ²å•†æ¸¬è©¦å»³</option>
                <option value="TidyéŠæˆ²ç´šè·æ¸¬è©¦å»³">TidyéŠæˆ²ç´šè·æ¸¬è©¦å»³</option>
                <option value="DB TEST">DB TEST</option>
            </select>
            <span class="slash">/</span>
            <div class="autocomplete-wrapper inline">
                <input type="text" id="account" class="memory-input" autocomplete="new-password"
                    name="nohistory-account" data-memory-key="account">
                <div class="suggestions"></div>
            </div>
        </div>

        <!-- è£ç½® -->
        <div class="form-row">
            <label>è£ç½®ï¼š</label>

            <div class="device-group">
                <!-- PC -->
                <div class="device-row" id="pc-row">
                    <label><input type="checkbox" class="device-check"
                        value="PC" id="device-pc"> PC</label>
                    <input type="text" id="pc-browser" autocomplete="new-password" name="nohistory-pcb"
                        class="browser-input" placeholder="ç€è¦½å™¨ç‰ˆæœ¬ï¼ˆä¾‹ï¼šChrome 120ï¼‰">
                </div>

                <!-- Android -->
                <div class="device-row">
                    <label><input type="checkbox" class="device-check"
                        value="Android" id="device-android"> Android</label>
                    <input type="text" id="android-os" autocomplete="new-password" name="nohistory-aos"
                        class="os-input" placeholder="ä¾‹ï¼š13">
                    <input type="text" id="android-browser" autocomplete="new-password" name="nohistory-ab"
                        class="browser-input" placeholder="ç€è¦½å™¨ç‰ˆæœ¬ï¼ˆä¾‹ï¼šChrome 118ï¼‰">
                </div>

                <!-- iOS -->
                <div class="device-row" id="ios-row">
                    <label><input type="checkbox" class="device-check"
                        value="iOS" id="ios-check"> iOS</label>
                    <input type="text" id="ios-os" autocomplete="new-password" name="nohistory-ios"
                        class="os-input" placeholder="ä¾‹ï¼š16.4">
                </div>
            </div>
        </div>

        <!-- iOS å­æ¬„ä½ï¼ˆå·²å¥—ç”¨ä½ è¦æ±‚çš„å·¦ç§» + å¯¬åº¦èª¿æ•´ï¼‰ -->
        <div class="form-row" id="ios-browser-wrapper" style="display:none;">
            <div class="ios-browser-group">

                <div class="device-row">
                    <label><input type="checkbox" class="ios-browser" id="ios-safari">
                        Safari</label>
                    <input type="text" id="ios-safari-version" autocomplete="new-password" name="nohistory-isv"
                        class="browser-version-input" placeholder="Safariç‰ˆæœ¬ç‚ºiOSç‰ˆæœ¬" readonly style="background:#ddd;color:#555;">
                </div>

                <div class="device-row">
                    <label><input type="checkbox" class="ios-browser" id="ios-chrome">
                        Chrome</label>
                    <input type="text" id="ios-chrome-version" autocomplete="new-password" name="nohistory-icv"
                        class="browser-version-input" placeholder="ä¾‹ï¼š120.1">
                </div>

                <div class="ios-extra-row">
                    <label>å…¶ä»–ï¼š</label>
                    <input type="text" id="ios-other-name" autocomplete="new-password" name="nohistory-ion"
                        class="browser-name-input" placeholder="ç€è¦½å™¨ï¼ˆä¾‹ï¼šEdgeï¼‰">
                    <input type="text" id="ios-other-version" autocomplete="new-password" name="nohistory-iov"
                        class="browser-version-input" placeholder="ä¾‹ï¼š121.0">
                </div>

            </div>
        </div>

        <div class="form-row">
            <label>æ³¨å–®ç·¨è™Ÿï¼š</label>
            <input type="text" id="order_id" autocomplete="new-password" name="nohistory-order" placeholder="æœªæœ‰æ³¨å–®å¯è·³é">
        </div>
    </div>
    <!-- æè¿°å…§å®¹ -->
    <div class="section">
        <h2>æè¿°å…§å®¹ï¼ˆå¯è²¼åœ–ç‰‡ï¼‰</h2>

        <div class="form-row vertical">
            <label>æ“ä½œï¼š</label>
            <div id="operation_editor" class="rich-editor large"
                contenteditable="true"></div>
        </div>

        <div class="form-row vertical">
            <label>å¯¦éš›çµæœï¼š</label>
            <div id="actual_editor" class="rich-editor large"
                contenteditable="true"></div>
        </div>

        <div class="form-row vertical">
            <label>é æœŸçµæœï¼š</label>
            <div id="expected_editor" class="rich-editor large"
                contenteditable="true"></div>
        </div>

        <div class="form-row vertical">
            <label>å‚™è¨»ï¼š</label>
            <div id="remark_editor" class="rich-editor medium"
                contenteditable="true"></div>
        </div>
    </div>

    <!-- æŒ‰éˆ• -->
    <div class="button-row">
        <button id="copy-title-btn">è¤‡è£½æ¨™é¡Œ</button>
        <button id="copy-btn">ä¸€éµè¤‡è£½</button>
    </div>

    <!-- é è¦½ -->
    <div class="section">
        <h2>æ–‡å­—é è¦½</h2>
        <input type="text" id="title-preview" readonly>
        <textarea id="full-preview" rows="16" readonly></textarea>
    </div>
</div>

<!-- ===================== JS ======================= -->
<script>
/* è¨­å®šä»Šæ—¥æ—¥æœŸ */
function setToday(){
    const d=document.getElementById("incident_date");
    const today=new Date().toISOString().split("T")[0];
    d.value=today;
    d.max=today;
}

/* éŠæˆ²æ¸…å–® */
const gameList=[["Game101","ç˜‹ç‹‚å¯¦é©—å®¤"],["Game102","é–‹é‹é‡‘ç…"],["Game103","æ˜Ÿéš›å†’éšª"],
["Game104","ç²¾éˆå¥‡åœ’"],["Game105","åŠŸå¤«é«˜æ‰‹"],["Game106","æ·˜é‡‘æ¨‚"],["Game107","åœ‹ç‹çš„ç¥•å¯¶"],
["Game108","å—æ¥µä¸–ç•Œ"],["Game109","è’é‡å¤§è¥¿éƒ¨"],["Game110","è¶…ç´šçŒ´å­"],["Game111","åˆºå®¢å¯†ä»¤"],
["Game112","ç™½è›‡å‚³"],["Game113","ç¾å‘³ä¸€ç•ª"],["Game114","å¹¸é‹æ´¾ç¿ å…‹"],["Game115","é­šè¦èŸ¹ slot"],
["Game116","å±å’è¥¿éŠ"],["Game117","é¬¥å£«å‚³å¥‡"],["Game118","å°ç´…å¸½:é€é¤å¤§ä½œæˆ°"],["Game119","å¨éœ‡å…¬å ‚"],
["Game120","é­”æ³•å­¸åœ’"],["Game122","ç™¼å¤§æŸ´"],["Game139","é‡‘ç¦ç‘ç¸"],["Game123","å·¨ç¸é‡‘å‰›"],
["Game124","åˆ®åˆ®æ¨‚"],["Game125","å¥‡é–€éç”²"],["Game126","æ³°æ¿•æ§"],["Game127","æš¹ç¾…ç¥æ‹³"],
["Game128","å“¥å¸ƒæ—ç¤¦å‘"],["Game129","æ¹–ä¸­å¥³ç¥"],["Game130","å¤å¢“é©šé­‚"],["Game131","çµ•ä¸–ç¥å·"],
["Game132","ç¾…æ‘©è¡é‚£"],["Game133","éª°å¯¶"],["Game134","ç™¾å®¶æ¨‚"],["Game135","5PK"],
["Game136","æ°´æœæ¨‚åœ’"],["Game137","é å¤ç”Ÿç‰©"],["Game138","é­”è±†"],["Game121","21é»"],
["Game140","ç¥é†«ç™¾è‰å‚³"],["Game141","é¾å®®å¯¶è—"],["Game142","ç¶­äº¬å‚³å¥‡"],["Game143","å¤§ç¬‘å½Œå‹’"],
["Game144","æ—¥è¼ªå¯¶æ®¿"],["Game145","è¦å¡çˆ­å¥ªæˆ°"],["Game146","æ°¸æ†ä¹‹å»"],["Game147","é¾é–€è©¦ç·´"],
["Game148","éæ´²ç…ç‹"],["Game149","è¿è²¡ç¥"],["Game150","æ’’å“ˆæ‹‰å¥‡ç·£"],["Game151","ç‰›ç‰›å¨¶è¦ª"],
["Game152","é‡‘ç‰›ç™¼ç™¼ç™¼"],["Game153","é¦¬é›…æœ«æ—¥"],["Game154","é‡æ€§çš„æ¸´æœ›"],["Game155","æ—è›‹å¥½ä¾†å±‹"],
["Game156","æ‹›è²¡èšå¯¶"],["Game157","åŠ å‹’æ¯”å¥‡èˆª"],["Game158","ä¼¯åˆ©æ†ä¹‹æ˜Ÿ"],["Game159","æ·»é‹è²¡ç¥"],
["Game160","ä¸‰åœ‹ç¾¤é›„"],["Game161","JPéº»å°‡èƒ¡äº†"],["Game162","æ•²å‰é¼ "],["Game163","786 SLOT"],
["Game164","é¾ç  â€§ å¤©å‘½"],["Game165","åˆ®åˆ®æ¨‚2 é¾è€€ç„¡é™"],["Game166","åˆ®åˆ®æ¨‚3 ç¾Šç¾ŠderE"],
["Game167","åŸƒåŠç¥•å¯¶"],["Game168","æ“Šé¼“è¿ç¦"],["Game169","EDMè¿·å¹»"],["Game170","å››è±¡æ‹±è²¡"],
["Game171","å·«æ¯’å‚³èªª"],["Game172","èŠ±é–‹å¯Œè²´"],["Game173","é€Ÿåº¦èˆ‡æ¿€æƒ…"],["Game174","èŠ±å¼5PK"],
["Game175","ç¦è™è‡¨é–€"],["Game176","è¶…ç´šå°„é–€"],["Game177","DICE"],["Game178","é³³å‡°å‚³èªª"],
["Game179","ä¼Šç”¸ç‹åº§"],["Game180","é›»éŸ³å…”å…”"],["Game181","åéˆ”æ©Ÿ"],["Game182","è¿è²¡ç¥ 2"],
["Game183","æ·»é‹è²¡ç¥2"],["Game184","é»ƒé‡‘éº»å°‡"],["Game185","é‡‘éŠ€é¯‰"],["Game186","æ˜Ÿæµ·å¾æˆ°"],
["Game187","è½Ÿèœœå¤§ä½œæˆ°"],["Game188","çƒ½èµ·é›²æ¹§æ™‚"],["Game189","æµ·æ´‹ç‰©èª"],["Game190","å‘½é‹ä¹‹æ‰‹"],
["Game191","çˆ†ç„°è¶³çƒ"],["Game192","å¥½é‹é‡‘èŸ¾"],["Game193","F.T.Gæ¦®è€€å‰ç·š"],["Game194","æ‹‰å¯†"],
["Game195","æ­¦ç¥è¶™å­é¾"],["Game196","ç‰›è½‰éŒ¢å¤"],["Game197","æ±éƒŠçš‡é™µ"],["Game198","æ­¦è–é—œç¾½"],
["Game199","æƒ¡é­”ç”œå¿ƒ"],["Game200","å¤©ä½¿å¯¶è²"],["Game201","JPéº»å°‡èƒ¡äº†2"],["Game202","æ˜Ÿçˆ†å®‡å®™"],
["Game203","é»è›‡æˆé‡‘"],["Game204","å°ç¥å‚³å¥‡"],["Game205","é–‹é–€å¤§å‰"],["Game206","ç‰›è½‰éŒ¢å¤2"],
["Game207","è™å˜¯é¾åŸ"],["Game208","å°„é¾é–€"],["Game209","æ·»é‹è²¡ç¥3"],["Game210","çš‡å®¶è€è™æ©Ÿ"],
["Game211","è²¡ç¥å¦™"],["Game212","Lucky Guess"],["Game213","é‡‘è±ªé¯‰"],["Game214","è³½é¦¬å¨˜"],
["Game215","Xå‹é€£çˆ†ä¸­å¼"]];

/* --- autocomplete éŠæˆ²æœå°‹ --- */
const gameInput=document.getElementById("game-select");
const gameSuggest=document.getElementById("game-suggestions");

function renderGameList(keyword=""){
    const kw=keyword.toLowerCase();
    gameSuggest.innerHTML="";

    const matches=gameList.filter(([id,name]) =>
        id.toLowerCase().includes(kw) || name.toLowerCase().includes(kw)
    );

    
    // åŠ å…¥ä¸€å€‹ç©ºç™½é¸é …
    const blankDiv = document.createElement("div");
    blankDiv.className = "suggestion-item";
    blankDiv.textContent = "(æ¸…é™¤é¸æ“‡)";
        blankDiv.addEventListener("mousedown", () => {
        gameInput.value = "";
        gameSuggest.style.display = "none";
        updateTitle();
    });
    gameSuggest.appendChild(blankDiv);

    matches.forEach(([id,name])=>{
        const div=document.createElement("div");
        div.className="suggestion-item";
        div.textContent=`${id} ${name}`;
        div.addEventListener("mousedown",()=>{
            gameInput.value=`${id} ${name}`;
            gameSuggest.style.display="none";
            updateTitle();
        });
        gameSuggest.appendChild(div);
    });

    gameSuggest.style.display = matches.length ? "block":"none";
}

gameInput.addEventListener("focus",()=>renderGameList(""));
gameInput.addEventListener("input",()=>{
    renderGameList(gameInput.value);
    updateTitle();
});
document.addEventListener("click",(e)=>{
    if(!gameInput.contains(e.target)) gameSuggest.style.display="none";
});

/* --- æ¨™é¡Œç”Ÿæˆ --- */
function updateTitle(){
    const full=gameInput.value.trim();
    const desc=document.getElementById("problem-desc").value.trim();
    let result="";

    if (full) {
        const parts = full.split(" ");
        const id = parts[0].replace('Game', '');
        const name = parts.slice(1).join(" ");
        result = `${id}_${name}_${desc}`;
    } else if (desc) {
        result = desc;
    }

    document.getElementById("title-preview").value=result;
    updateFullPreview();
}
document.getElementById("problem-desc").addEventListener("input",updateTitle);

/* --- æ™ºèƒ½ OS è£œå­—é¦– --- */
function formatOS(prefix, value){
    value = value.trim();
    if (!value) return "";
    return `${prefix} ${value}`;
}

/* --- æ™ºèƒ½ç€è¦½å™¨åˆ¤æ–·ï¼ˆPC / Android å…±ç”¨ï¼‰ --- */
function formatBrowser(value){
    const v = value.trim();
    if (!v) return "";

    if (!/^[0-9.]+$/.test(v)){
        return `ç€è¦½å™¨ï¼š${v}`;
    }
    return `ç€è¦½å™¨ï¼šChrome ${v}`;
}

/* --- è£ç½®è³‡æ–™çµ„è£ï¼ˆå›å‚³æ¯è£ç½®ä¸€è¡Œå­—ä¸²ï¼‰ --- */
function getDeviceLines(){
    const list = [];

    // PC
    if (document.getElementById("device-pc").checked) {
        const br = formatBrowser(document.getElementById("pc-browser").value);
        let line = "ï¼PC";
        if (br) line += `ï¼ˆ${br}ï¼‰`;
        list.push(line);
    }

    // Android
    if (document.getElementById("device-android").checked) {
        const os = formatOS("Android", document.getElementById("android-os").value);
        const br = formatBrowser(document.getElementById("android-browser").value);

        let line = "ï¼Android";
        if (os) line += `ï¼ˆ${os}ï¼‰`;
        if (br) line += `ï¼ˆ${br}ï¼‰`;
        list.push(line);
    }

    // iOS
    if (document.getElementById("ios-check").checked) {
        const os = formatOS("iOS", document.getElementById("ios-os").value);

        const parts = [];

        if (document.getElementById("ios-safari").checked) {
            const v = document.getElementById("ios-os").value.trim();
            if (v) parts.push(`Safari ${v}`);
        }

        if (document.getElementById("ios-chrome").checked) {
            const v = document.getElementById("ios-chrome-version").value.trim();
            if (v) parts.push(`Chrome ${v}`);
        }

        const on = document.getElementById("ios-other-name").value.trim();
        const ov = document.getElementById("ios-other-version").value.trim();
        if (on) parts.push(ov ? `${on} ${ov}` : on);

        let line = "ï¼iOS";
        if (os) line += `ï¼ˆ${os}ï¼‰`;
        if (parts.length) line += `ï¼ˆç€è¦½å™¨ï¼š${parts.join("ã€")}ï¼‰`;
        list.push(line);
    }

    return list;
}

/* --- é è¦½å…§å®¹æ›´æ–° --- */
function updateFullPreview(){
    const date=document.getElementById("incident_date").value;
    const tester=document.getElementById("tester").value;
    const version=document.getElementById("version").value;
    const site=document.getElementById("site").value;
    const hall=document.getElementById("hall").value;
    const account=document.getElementById("account").value;
    const order = document.getElementById("order_id").value.trim() || "-";

    const op=document.getElementById("operation_editor").innerText.trim();
    const act=document.getElementById("actual_editor").innerText.trim();
    const exp=document.getElementById("expected_editor").innerText.trim();
    const remark=document.getElementById("remark_editor").innerText.trim();

    const lines = [];
    const bugLvl=document.getElementById("bug_level").value;
    const bugD=document.getElementById("bug_def").value;

    lines.push(`ç™¼ç”Ÿæ™‚é–“ï¼š${date}`);
    lines.push(`æ¸¬è©¦è€…ï¼š${tester}`);
    if(bugLvl){ lines.push(`BUG ç­‰ç´šï¼š${bugLvl}ï¼ˆ${bugD}ï¼‰`); }
    lines.push(`ç‰ˆæœ¬ï¼š${version}`);
    lines.push(`ç«™åˆ¥ï¼š${site}`);
    if (site === "è©¦ç©æ¨¡å¼") {
    lines.push(`æ¸¬è©¦å»³ä¸»ï¼š${hall}`);
} else {
    lines.push(`æ¸¬è©¦å»³ä¸»/å¸³è™Ÿï¼š${hall} / ${account}`);
}

    const deviceLines = getDeviceLines();
    
lines.push(`è£ç½®ï¼š`);
    deviceLines.forEach(l => lines.push(l));

    lines.push(`æ³¨å–®ç·¨è™Ÿï¼š${order}`);
    lines.push("");
    lines.push("æ“ä½œï¼š");
    lines.push(op);
    lines.push("");
    lines.push("å¯¦éš›çµæœï¼š");
    lines.push(act);
    lines.push("");
    lines.push("é æœŸçµæœï¼š");
    lines.push(exp);
    lines.push("");
    lines.push("å‚™è¨»ï¼š");
    lines.push(remark);

    document.getElementById("full-preview").value = lines.join("\n");
}

/* --- è¤‡è£½ --- */
document.getElementById("copy-title-btn").addEventListener("click",()=>{
    navigator.clipboard.writeText(document.getElementById("title-preview").value);
    alert("æ¨™é¡Œå·²è¤‡è£½ï¼");
});
document.getElementById("copy-btn").addEventListener("click",()=>{
    navigator.clipboard.writeText(document.getElementById("full-preview").value);
    alert("å…¨æ–‡å·²è¤‡è£½ï¼ˆä¸å«æ¨™é¡Œï¼‰ï¼");
});

/* --- è‡ªè¨‚è¨˜æ†¶ autocomplete --- */
function loadMemory(key){ try{return JSON.parse(localStorage.getItem(key))||[]}catch{return[]} }
function saveMemory(key,arr){ localStorage.setItem(key,JSON.stringify(arr)); }

function setupMemoryField(id,key){
    const input=document.getElementById(id);
    const wrap=input.closest(".autocomplete-wrapper");
    const box=wrap.querySelector(".suggestions");
    let list=loadMemory(key);

    function render(filter=""){
        const kw=filter.toLowerCase();
        box.innerHTML="";

        const matches=list.filter(v=>v.toLowerCase().includes(kw));
        matches.forEach(v=>{
            const div=document.createElement("div");
            div.className="suggestion-item";
            div.textContent=v;
            div.addEventListener("mousedown",()=>{
                input.value=v;
                box.style.display="none";
                updateFullPreview();
            });
            box.appendChild(div);
        });

        box.style.display = matches.length ? "block":"none";
    }

    input.addEventListener("focus",()=>render(""));
    input.addEventListener("input",()=>render(input.value));

    input.addEventListener("blur",()=>{
        const v=input.value.trim();
        if(v && !list.includes(v)){
            list.push(v);
            saveMemory(key,list);
        }
        setTimeout(()=>box.style.display="none",120);
    });
}

/* --- åˆå§‹åŒ– --- */
window.addEventListener("DOMContentLoaded",()=>{
    const bugDefOptions={
        "é«˜":[
            "æ ¸å¿ƒåŠŸèƒ½ç„¡æ³•ä¾›ä½¿ç”¨ã€æœå‹™ä¸­æ–·ã€è³‡æ–™åš´é‡éŒ¯èª¤",
            "éæ ¸å¿ƒæµç¨‹ä¸­æ–·ï¼Œä½†æœƒé€ æˆå¤§ç¯„åœä½¿ç”¨å½±éŸ¿"
        ],
        "ä¸­":[
            "åŠŸèƒ½ç•°å¸¸ä½†å¯æ›¿ä»£ã€å¯ç¹é",
            "åœ–ç‰‡é¡¯ç¤ºä¸å®Œæ•´"
        ],
        "ä½":[
            "é«”é©—æˆ–é¡¯ç¤ºå•é¡Œï¼Œä¸å½±éŸ¿ä¸»è¦åŠŸèƒ½"
        ]
    };

    const bugLevel=document.getElementById("bug_level");
    const bugDef=document.getElementById("bug_def");

    bugLevel.addEventListener("change",()=>{
        const lvl=bugLevel.value;
        bugDef.innerHTML="";
        if(bugDefOptions[lvl]){
            bugDefOptions[lvl].forEach(txt=>{
                const op=document.createElement("option");
                op.value=txt;
                op.textContent=txt;
                bugDef.appendChild(op);
            });
            bugDef.disabled=false;
        }else{
            bugDef.disabled=true;
            const op=document.createElement("option");
            op.textContent="è«‹å…ˆé¸æ“‡ BUG ç­‰ç´š";
            bugDef.appendChild(op);
        }
        updateFullPreview();
    });

    bugDef.addEventListener("change",updateFullPreview);

    setToday();
// ğŸ”’ è©¦ç©æ¨¡å¼ â†’ å¸³è™Ÿæ¬„ä½å‡çµ + æ¸…ç©º
document.getElementById("site").addEventListener("change", () => {
    const site = document.getElementById("site").value;
    const accountInput = document.getElementById("account");

    if (site === "è©¦ç©æ¨¡å¼") {
        accountInput.value = "";
        accountInput.disabled = true;
    } else {
        accountInput.disabled = false;
    }

    updateFullPreview();
});


// è‡ªå‹•åŒæ­¥ iOS OS ç‰ˆæœ¬åˆ° Safari æ¬„ä½
document.getElementById("ios-os").addEventListener("input", () => {
    const os = document.getElementById("ios-os").value.trim();
    document.getElementById("ios-safari-version").value = os;
});


    setupMemoryField("tester","tester");
    setupMemoryField("version","version");
    setupMemoryField("account","account");
// å¼·åŒ–å¸³è™Ÿæ¬„ä½çš„å³æ™‚é è¦½æ›´æ–°
["input","keyup","change","blur"].forEach(ev => {
    document.getElementById("account").addEventListener(ev, updateFullPreview);
});

    updateFullPreview();

    // æ§åˆ¶ iOS å­æ¬„ä½é¡¯ç¤º
    document.querySelectorAll(".device-check").forEach(chk=>{
        chk.addEventListener("change",()=>{
            const ios=document.getElementById("ios-check").checked;
            document.getElementById("ios-browser-wrapper").style.display = ios ? "flex" : "none";
            updateFullPreview();
        });
    });

    // iOS å­ç€è¦½å™¨æ›´æ–°
    document.querySelectorAll(".ios-browser").forEach(chk=>{
        chk.addEventListener("change",updateFullPreview);
    });

    // åŸºæœ¬æ¬„ä½
    [
        "incident_date","site","hall","order_id",
        "operation_editor","actual_editor","expected_editor","remark_editor"
    ].forEach(id=>{
        document.getElementById(id).addEventListener("input",updateFullPreview);
    });

    // è£ç½®æ¬„ä½
    [
        "pc-browser",
        "android-os","android-browser",
        "ios-os",
        "ios-safari-version","ios-chrome-version",
        "ios-other-name","ios-other-version"
    ].forEach(id=>{
        const el=document.getElementById(id);
        if(el) el.addEventListener("input",updateFullPreview);
    });
});
</script>

</body>
</html>
